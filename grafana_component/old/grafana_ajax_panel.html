<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    </head>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>

        $(document).ready(function(){
            const now = new Date()
            const panel_width = 500
            const panel_height = 500
            const grafanaPanelUrl = constructUrl(1, now.getTime(), now.getTime() - calculateTimeDelta(), 
                                    2, panel_width, panel_height)
            const apiKey =  "eyJrIjoiZkU1ekF3ckRtVHhKN0xNbWRGQnJJa3FuS005cUd2U3YiLCJuIjoidGVzdF9rZXkiLCJpZCI6MX0="
            $.ajax({
                type: 'GET',
                url: grafanaPanelUrl,
                headers: {
                    Authorization: `Bearer ${apiKey}`
                },
                success: function(data){
                    console.log(data)
                    $("#grafana-img").attr('src', data)
                    $("#grafana-iframe").attr('src', data)
                },
                error: function(err){
                    console.log(err)
                }
            })
        })

        function constructUrl(orgId, from, to, panelId, width, height){
            const grafanaHost = 'http://localhost:8088'
            const renderDashboard = `${grafanaHost}/render/d-solo/TwYnCJtWz/test-dashboard`
            // query = `?orgId=${orgId}&from=${from}&to=${to}&panelId=${panelId}&width=${width}&height=${height}`
            query = `?orgId=${orgId}&panelId=${panelId}&width=${width}&height=${height}`
            return renderDashboard.concat(query)
        };

        function calculateTimeDelta(){
            const now = new Date();
            const secsPerYear = 31536000;
            return (now.getTime() - secsPerYear)
        };

    </script>

    <body>
        <h1>Ajax Src</h1>
        <p>
            Ajax HTTP calls directly to http://localhost:8088/render/d-solo-/*******/test-dashboard<br>
            on load. Authorization headers are set before call.<br><br>
            <u>First frame:</u> <i>img</i> with src set to response<br>
            <b>Result:</b> CORS Error<br><br>
            <u>Second frame:</u> <i>iframe</i> with src set to response<br>
            <b>Result:</b> CORS Error <br><br>
        </p>
        <img id = "grafana-img" src="">
        <iframe id = "grafana-iframe" src = ""></iframe>
    </body>

</html>